# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Fixed
- **Wolfenstein-like Raycasting FPS** (game-006): Fixed HUD direction display showing NaN
  - Issue: DIR attribute in HUD was reading `player.angle` which doesn't exist
  - Solution: Changed to read `player.playerAngle` property which is the correct property name
  - File: [game-006/js/ui.js](game-006/js/ui.js#L50)

### Changed
- **Wolfenstein-like Raycasting FPS** (game-006): Deep Kaplay Integration - Architecture Overhaul
  - **Kaplay-Native Rendering**: Complete migration to Kaplay's drawing API
    - Removed separate Canvas 2D API usage entirely
    - All rendering now uses Kaplay functions: `drawUVQuad()`, `drawRect()`, `drawCircle()`, `drawLine()`, `drawText()`
    - Eliminated dual-canvas system - single Kaplay canvas handles everything
    - Uses Kaplay's transform stack (`pushTransform()`/`popTransform()`) for camera shake
    - Better color handling with `k.rgb()`, `k.rgba()`, `k.BLACK.lerp(k.WHITE, brightness)`
  - **Texture System**: Wall textures with UV mapping (like official Kaplay raycasting example)
    - Created new `js/textures.js` module for sprite loading and slicing
    - Pre-slices wall textures into vertical strips on load
    - Uses Kaplay's `Quad` system for proper UV coordinate mapping
    - Renders textured walls with `drawUVQuad()` instead of solid colors
    - Graceful fallback to solid colors if textures not loaded yet
  - **Player as Kaplay Game Object**: Component-based player entity
    - Player created with `k.add()` as proper Kaplay game object
    - Uses Kaplay components: `pos()`, `z()`, `opacity()`
    - Custom `draw()` function on player object renders entire 3D raycasting view
    - Custom `update()` function syncs position between Kaplay and raycasting systems
    - Follows official Kaplay raycasting example architecture pattern
  - **Enhanced Raycaster**: Better data for texture mapping
    - Added hit coordinates (`hitX`, `hitY`) to ray data for UV calculation
    - Added normal vectors (`normalX`, `normalY`) for lighting/shading
    - Determines which wall face was hit (x-side vs y-side) for proper texture wrapping
  - **Simplified Main Loop**: Cleaner separation of concerns
    - Removed manual `render()` call from `onDraw()`
    - Player's custom `draw()` function handles all rendering automatically
    - Kaplay manages the complete rendering pipeline
  - **Architecture Benefits**:
    - Follows official Kaplay patterns (based on example-raycast.js)
    - Cleaner, more maintainable code using Kaplay conventions
    - Ready for sprite-based enemies using same billboarding technique
    - Easy to add weapon sprites and other textured elements
    - Single unified rendering pipeline through Kaplay
    - Better integration with Kaplay's component system
  - Files: Created [game-006/js/textures.js](game-006/js/textures.js), [game-006/KAPLAY-INTEGRATION.md](game-006/KAPLAY-INTEGRATION.md), Rewritten [game-006/js/renderer.js](game-006/js/renderer.js), [game-006/js/player.js](game-006/js/player.js), Updated [game-006/js/raycaster.js](game-006/js/raycaster.js), [game-006/js/main.js](game-006/js/main.js)

- **Wolfenstein-like Raycasting FPS** (game-006): Refactored to use Kaplay engine architecture
  - **Dual-Canvas Hybrid System**: Integrated Kaplay while preserving custom raycasting renderer
    - Separate Canvas 2D for raycasting rendering (z-index: 0)
    - Transparent Kaplay WebGL canvas for UI overlays (z-index: 1)
    - Both canvases positioned in container div with perfect alignment
  - **Kaplay Integration**: Adopted Kaplay patterns from game-005
    - State management system with `state.js` singleton
    - Event bus system with `events.js` for cross-module communication
    - Kaplay game loop with `k.onUpdate()` for logic and `k.onDraw()` for rendering
    - Input handling using `k.isKeyDown()` for keyboard controls
    - Scene management with `k.scene()` and `k.go()`
  - **New Modular Architecture**:
    - Created `js/state.js` - Centralized game state (player reference, FPS, pause state)
    - Created `js/events.js` - EventBus class for future features (enemies, pickups)
    - Created `js/input.js` - Mouse lock and pointer management
    - Created `js/ui.js` - Kaplay-based HUD overlay (FPS, position, direction, controls)
    - Refactored `js/main.js` - Kaplay initialization with transparent background
    - Refactored `js/player.js` - Uses Kaplay's input system and game loop
    - Refactored `js/renderer.js` - Dual-canvas setup with direct Canvas 2D rendering
    - Simplified `js/index.html` - Kaplay manages canvas creation automatically
  - **Preserved Features**: All original raycasting functionality maintained
    - DDA raycasting algorithm unchanged (640 rays, perpendicular distance)
    - Wall rendering with distance shading and side-based darkening
    - Circular collision detection with wall sliding
    - Mouse look, WASD movement, strafing, sprint
  - **Architecture Benefits**:
    - Consistent with game-005 patterns for easier future development
    - Event-driven communication for adding enemies, weapons, pickups
    - Kaplay handles game loop timing and delta time automatically
    - Clean separation between raycasting engine and UI overlay
    - Foundation for Phase 2 features (enemies, weapons, items)
  - Files: Updated [game-006/js/main.js](game-006/js/main.js), [game-006/js/player.js](game-006/js/player.js), [game-006/js/renderer.js](game-006/js/renderer.js), [game-006/index.html](game-006/index.html), Created [game-006/js/state.js](game-006/js/state.js), [game-006/js/events.js](game-006/js/events.js), [game-006/js/input.js](game-006/js/input.js), [game-006/js/ui.js](game-006/js/ui.js)

### Added
- **Wolfenstein-like Raycasting FPS** (game-006): Phase 1 - Raycasting Engine Foundation
  - **Raycasting Engine**: Complete DDA (Digital Differential Analysis) algorithm implementation
    - One ray per screen column (640 rays at 640×400 resolution)
    - Efficient wall detection with perpendicular distance calculation
    - Prevents fisheye distortion effect
    - Maximum ray distance: 20 units with distance clamping
  - **Player Movement System**: Smooth movement with collision detection
    - Forward/backward movement (W/S or Arrow Up/Down)
    - Strafe left/right (A/D keys)
    - Sprint mode (Hold Shift for 1.67× speed boost)
    - Collision detection with circular radius (0.3 units)
    - Wall sliding mechanic (smooth movement along walls)
  - **Camera System**: First-person view with 60° field of view
    - Arrow keys for rotation (120°/second)
    - Mouse look support (click canvas to lock mouse)
    - Camera plane calculation for proper FOV rendering
    - Direction and plane vectors updated from player angle
  - **Wall Rendering**: Distance-based shading with multiple wall types
    - 4 wall types with distinct colors: Gray stone, Red brick, Brown wood, Silver metal
    - Distance shading: Linear falloff from bright to dark (20%-100% brightness)
    - Vertical vs horizontal wall differentiation (horizontal walls 30% darker)
    - Wall height calculated from distance for 3D perspective
    - Solid color ceiling (dark blue) and floor (darker blue)
  - **Test Map**: 16×16 grid with varied room layouts
    - Outer walls forming perimeter
    - Interior rooms with different wall types
    - Corridors and open spaces
    - Multiple wall types for visual variety
  - **Controls**: Complete keyboard and mouse input
    - W/S or ↑/↓: Move forward/backward
    - A/D: Strafe left/right
    - ←/→ or Mouse: Rotate camera
    - Shift: Sprint
    - Click canvas to enable mouse look
  - **HUD Display**: Real-time stats overlay
    - FPS counter (updates every 0.5 seconds)
    - Player position (X, Y coordinates)
    - Player direction (angle in degrees)
    - Stats panel with semi-transparent background
  - **Technical Implementation**:
    - Modular ES6 architecture (7 modules: main, config, raycaster, player, renderer, map, utils)
    - Pure vanilla JavaScript (no frameworks for raycasting)
    - 640×400 resolution with crisp pixel rendering
    - 60 FPS target with delta-time based movement
    - Efficient collision detection (checks 4 corners of bounding circle)
  - Files: [game-006/index.html](game-006/index.html), [game-006/js/main.js](game-006/js/main.js), [game-006/js/config.js](game-006/js/config.js), [game-006/js/raycaster.js](game-006/js/raycaster.js), [game-006/js/player.js](game-006/js/player.js), [game-006/js/renderer.js](game-006/js/renderer.js), [game-006/js/map.js](game-006/js/map.js), [game-006/js/utils.js](game-006/js/utils.js), [game-006/game-plan.md](game-006/game-plan.md)

### Added
- **Bullet Heaven Shmup** (game-005): Phase 1 - Core Gameplay Foundation
  - **Project Architecture**: Event-driven modular system with ES6 modules
    - EventBus class for cross-module communication without tight coupling
    - Global game state management with stat multipliers for upgrades
    - Prefab pattern for reusable entity creation
    - 8 core modules: main, config, events, state, sounds, prefabs, player, projectiles, enemies, waves, ui
  - **Player Character**: Auto-shooting character with smooth movement
    - 8-directional movement (WASD or Arrow keys)
    - Precise movement without acceleration/friction for tight control
    - Small visible hitbox indicator (3px core)
    - Invincibility frames (1 second) after taking damage with visual feedback
    - Auto-targeting system shoots at nearest enemy
    - Health: 100 HP, Speed: 200, Base damage: 10
  - **Auto-Shooting Mechanic**: Automatic weapon system
    - Shoots automatically toward nearest enemy every 0.5 seconds
    - Blue projectiles with white outline for clear visibility
    - Collision detection with enemies
    - Sound effect on each shot (600Hz square wave)
  - **Enemy System**: Wave-based spawning with basic enemy types
    - 3 enemy types with distinct behaviors:
      - **Charger**: Medium speed (80), 50 HP, 10 damage, 5 XP
      - **Fast**: High speed (150), 30 HP, 5 damage, 8 XP
      - **Tank**: Slow (40), 200 HP, 25 damage, 20 XP
    - Chase AI - enemies move directly toward player
    - HP bars above enemies (green → yellow → red)
    - Shadows for depth perception
    - Enemies spawn from random screen edges
  - **Wave System**: Continuous spawning with difficulty scaling
    - Enemies spawn at regular intervals (2 seconds initially)
    - Spawn rate increases over time (minimum 0.5 seconds)
    - Gradually increasing difficulty as game progresses
    - Spawn position randomization from all four screen edges
  - **XP & Leveling System**: Progression loop with magnetic collection
    - XP gems drop on enemy death (green glowing gems)
    - Magnetic attraction within 100px radius
    - Bob animation for visual appeal
    - Level up system: 10 XP for level 2, scales by 1.5x per level
    - Level-up sound effect (ascending 4-note chord)
  - **Web Audio API Sound System**: Procedurally generated sound effects
    - 8 sound effects: player shoot, enemy hit, enemy death, XP collect, level up, player hurt
    - Master gain node for volume control (30% default)
    - No external audio files required - all procedurally generated
    - Chord-based effects for satisfying feedback
  - **HUD System**: Complete real-time UI display
    - Health bar (top-left): Red bar with text showing HP/MaxHP
    - XP bar (bottom): Green bar showing progress to next level
    - Level display: Current player level
    - Timer: Minutes:seconds format tracking survival time
    - Kill counter: Total enemies defeated (top-right)
    - All UI elements update in real-time with fixed positioning
  - **Visual Design**: High contrast clarity-first approach
    - Player: Blue circle with white hitbox core
    - Enemies: Red/yellow/gray color coding by type
    - Projectiles: Blue (player) with clear visibility
    - XP Gems: Bright green with glowing outline
    - Shadows on all entities for depth
    - Outlined shapes for clear distinction
  - **Game Over System**: Stats display and restart functionality
    - Darkened overlay on game over
    - Final stats: Time survived, total kills, level reached
    - Press R to restart with full state reset
    - Clean game over screen with statistics
  - **Splash Screen**: Professional game entry screen
    - Gradient background with title and subtitle
    - "START GAME" button with hover effects
    - Control instructions displayed on splash
    - Audio context initialization on start (Web Audio API requirement)
    - Smooth fade-out transition to gameplay
  - **Quality of Life Features**:
    - Player stays within screen bounds (20px padding)
    - Safe spawn zones (enemies spawn off-screen)
    - Forgiving hitbox (player hitbox smaller than visual)
    - Smooth 60 FPS gameplay
    - High-DPI display support with crisp rendering
  - Files: [game-005/index.html](game-005/index.html), [game-005/js/main.js](game-005/js/main.js), [game-005/js/config.js](game-005/js/config.js), [game-005/js/events.js](game-005/js/events.js), [game-005/js/state.js](game-005/js/state.js), [game-005/js/sounds.js](game-005/js/sounds.js), [game-005/js/prefabs.js](game-005/js/prefabs.js), [game-005/js/player.js](game-005/js/player.js), [game-005/js/projectiles.js](game-005/js/projectiles.js), [game-005/js/enemies.js](game-005/js/enemies.js), [game-005/js/waves.js](game-005/js/waves.js), [game-005/js/ui.js](game-005/js/ui.js), [game-005/game-plan.md](game-005/game-plan.md)

- **Tower Defense Game** (game-004): Phase 4 - Upgrades & Economy System
  - **Tower Upgrade System**: 3-tier upgrade progression for all tower types
    - Each tower has 3 upgrade levels with increasing costs
    - Upgrades boost damage, range, attack speed, and tower-specific stats
    - Visual level indicators: star display (☆☆☆) showing upgrade progress
    - Upgrade costs scale by tower type (Archer: 80→120→180, Sniper: 250→400→600)
    - Tower name shows current level (e.g., "Archer [Lv 2]")
  - **Dynamic Stat Upgrades**: Tower-specific bonuses per upgrade tier
    - Archer: +5/+8/+12 damage, +20/+30/+40 range, +0.2/+0.3/+0.5 attack speed
    - Cannon: +25/+40/+70 damage, +30/+50/+70 range, +10/+20/+30 splash radius
    - Mage: +10/+15/+25 damage, +25/+35/+50 range, +0.1/+0.15/+0.2 slow amount
    - Tesla: +12/+20/+35 damage, +20/+30/+50 range, +1/+1/+2 chain count
    - Sniper: +50/+80/+150 damage, +50/+80/+100 range, +0.1/+0.15/+0.25 attack speed
  - **Tower Sell System**: Sell towers for strategic repositioning
    - Sell for 75% refund of total investment (base cost + all upgrades)
    - Frees up grid cell for new tower placement
    - Visual feedback with floating gold text showing refund amount
    - Keyboard shortcut: S key to sell selected tower
  - **Tower Targeting Priorities**: 4 strategic targeting modes per tower
    - **First**: Target enemy closest to exit (default) - prevents leaks
    - **Last**: Target enemy furthest from exit - maximize damage time
    - **Strongest**: Target highest HP enemy - focus fire on tanks
    - **Weakest**: Target lowest HP enemy - quick eliminations
    - Easy switching via UI buttons with visual selection indicator
    - Each tower can have independent targeting priority
  - **Tower Info Panel**: Comprehensive stats display when tower selected
    - Shows current damage, range, and attack speed stats
    - Displays upgrade level with filled/empty star indicators
    - Upgrade button shows next upgrade cost and grays out when unaffordable
    - Sell button shows refund amount calculated from total investment
    - 2×2 grid of targeting priority buttons with highlight on current mode
    - Panel appears on left side (220×340px) when clicking any tower
    - Real-time updates when gold changes to show affordability
  - **Visual Upgrade Effects**: Particle burst animation on upgrade
    - 12 golden particles radiate outward from upgraded tower
    - Particles fade out while moving away from center
    - Range indicator updates to show new range after upgrade
  - **Keyboard Shortcuts**: Quick tower management
    - U key: Upgrade selected tower (if affordable and not max level)
    - S key: Sell selected tower (75% refund)
    - Works from anywhere when tower is selected
  - **Centralized Event Delegation System**: Robust UI click handling
    - `UI_BOUNDS` object defines all UI panel dimensions
    - `isClickOnUI()` helper function checks if click is on any UI element
    - Global click handlers respect all UI areas automatically
    - Easy to add new UI elements without breaking click detection
    - Prevents game clicks from interfering with UI buttons
  - **Economic Balance**: Carefully tuned costs for strategic depth
    - Upgrade costs increase exponentially per tier
    - High-tier towers have higher upgrade costs (Sniper most expensive)
    - 75% sell refund allows strategic repositioning without total loss
    - Wave completion bonuses ($25) help fund mid-game upgrades
    - Economy maintains challenge throughout all 20 waves
  - Files: Updated [game-004/js/config.js](game-004/js/config.js) (added upgrade definitions, targeting priorities), [game-004/js/towers.js](game-004/js/towers.js) (upgrade/sell functions, targeting system), [game-004/js/state.js](game-004/js/state.js) (freeCell method), [game-004/js/ui.js](game-004/js/ui.js) (tower info panel, event delegation), [game-004/game-plan.md](game-004/game-plan.md) (Phase 4 completed)

### Fixed
- **Tower Defense Game** (game-004): Fixed tower info panel buttons not clickable
  - Issue: Panel buttons were being intercepted by global click handler before onClick events could fire
  - Solution: Implemented centralized event delegation system with `isClickOnUI()` helper
  - Global click handlers now check UI bounds before processing game clicks
  - Files: [game-004/js/ui.js](game-004/js/ui.js), [game-004/js/towers.js](game-004/js/towers.js)

### Added
- **Tower Defense Game** (game-004): Complete Sound System & Splash Screen
  - **Splash Screen**: Professional game entry screen with start button
    - Gradient background with animated title and subtitle
    - "Start Game" button with hover effects and animations
    - Game instructions displayed on splash (controls and objectives)
    - Audio context initialization on user interaction (required for Web Audio API)
    - Fade-out transition when starting game
  - **Web Audio API Sound System**: Procedurally generated sound effects using oscillators
    - 10 unique sound effects: tower placement, shooting, enemy hits/deaths, coin collection, wave events, game end states, UI interactions
    - Chords and frequency sweeps for rich audio feedback
    - Master volume control (30% default) via gain node
    - No external audio files required - all sounds generated programmatically
  - **Sound Toggle Button**: In-game sound control in HUD
    - Musical note icon (♪/♫) toggles between enabled/disabled states
    - Visual feedback with color change (green when on, gray when off)
    - Sound state persists during session
    - Toggle button positioned in top HUD next to wave button
  - **Complete Audio Feedback**: Sound effects integrated throughout gameplay
    - Tower placement sound (chord: A4, C#5, E5)
    - Shooting sound (frequency sweep from 800Hz to 200Hz)
    - Enemy hit sound (150Hz square wave)
    - Enemy death sound (300Hz to 50Hz sawtooth sweep)
    - Coin collection sound (chord: C5, E5, G5)
    - Wave start sound (200Hz to 600Hz triangle sweep)
    - Wave complete sound (4-note chord)
    - Game over sound (400Hz to 100Hz dramatic fall)
    - Victory sound (ascending 4-note melody: C5, D5, E5, G5)
    - UI click sound (600Hz short beep)
  - Files: Created [game-004/js/sounds.js](game-004/js/sounds.js), updated [game-004/js/main.js](game-004/js/main.js), [game-004/js/enemies.js](game-004/js/enemies.js), [game-004/js/towers.js](game-004/js/towers.js), [game-004/js/ui.js](game-004/js/ui.js)

### Changed
- **Tower Defense Game** (game-004): Improved rendering quality on high-DPI displays
  - Changed `pixelDensity` from fixed value of 1 to `Math.min(window.devicePixelRatio, 2)`
  - Allows sharper rendering on Retina/high-DPI screens while capping at 2x for performance
  - File: [game-004/js/main.js](game-004/js/main.js#L16)

### Technical
- Updated Claude Code permissions in `.claude/settings.local.json`
  - Added PowerShell and Node.js command permissions for development workflow
  - Added localhost WebFetch permission for local testing

### Added
- **Tower Defense Game** (game-004): Phase 3 - Enemy Variety & Waves
  - **5 Enemy Types**: Expanded from 1 to 5 distinct enemy types with strategic diversity
    - **Scout**: Fast movement (90 speed), low HP (40), no armor - Basic early game enemy
    - **Soldier**: Medium speed (70), 100 HP, 5 armor - Standard armored infantry
    - **Tank**: Slow movement (40), high HP (300), heavy armor (20) - Armored tank requiring anti-armor towers
    - **Speedster**: Very fast (140 speed), medium HP (60), no armor - Quick striker that dodges defenses
    - **Boss**: Massive HP (800), heavy armor (30), huge rewards (150 gold) - Epic boss enemy
  - **Armor System**: Complete damage reduction mechanics
    - Armor reduces incoming damage: `finalDamage = max(1, baseDamage - effectiveArmor)`
    - Armor pierce mechanic for Sniper tower (ignores 50% of armor)
    - All damage sources respect armor (projectiles, splash, chain lightning)
    - `calculateDamage()` function handles armor calculations
  - **Unique Enemy Visuals**: Distinctive designs for each enemy type
    - Tank: Square armor plating with layered gray/green design
    - Boss: Purple body with 8 golden crown spikes in radial pattern
    - Speedster: Streamlined yellow design with inner glow
    - Soldier: Green with enhanced details
    - Scout: Red basic design (from Phase 1)
  - **20 Progressive Waves**: Expanded from 10 to 20 waves with strategic variety
    - Waves 1-4: Tutorial waves introducing single enemy types
    - Wave 5: First boss wave
    - Waves 6-9: Mixed enemy compositions (scouts + soldiers, speedsters + scouts, etc.)
    - Wave 10: Boss + soldiers support wave
    - Waves 11-14: Increased difficulty with tanks and speedsters
    - Wave 15: Double boss wave with speedster swarm
    - Waves 16-19: Maximum challenge with 3-type mixed compositions
    - Wave 20: Epic final boss wave (3 bosses + 5 tanks + 10 speedsters)
  - **Boss Wave Features**: Special visual treatment for boss encounters
    - Boss waves trigger every 5 waves (waves 5, 10, 15, 20)
    - Warning banner appears on screen: "⚠ BOSS WAVE X ⚠" with purple/gold styling
    - Banner auto-fades after 3 seconds
    - Wave counter shows "BOSS WAVE" in orange/red color during boss waves
    - `isBoss` flag in wave definitions marks boss waves
  - **Wave Preview UI**: Shows upcoming enemy composition
    - "Next:" label displays upcoming wave enemies in HUD
    - Colored enemy icons with count indicators (e.g., "×8")
    - Boss wave warning indicator (⚠) in preview
    - Updates automatically after each wave completion
    - Helps players plan tower strategy for next wave
  - **Enemy Stat Scaling**: Progressive difficulty curve
    - Early waves: Low HP enemies for learning
    - Mid waves: Armored enemies requiring tower upgrades
    - Late waves: Fast enemies and heavy armor combinations
    - Boss waves: Strategic challenges requiring optimal tower placement
  - Files: Updated [game-004/js/config.js](game-004/js/config.js), [game-004/js/enemies.js](game-004/js/enemies.js), [game-004/js/towers.js](game-004/js/towers.js), [game-004/js/ui.js](game-004/js/ui.js), [game-004/game-plan.md](game-004/game-plan.md)

- **Tower Defense Game** (game-004): Phase 2 - Tower Variety & Special Abilities
  - **5 Unique Tower Types**: Expanded from 1 to 5 distinct towers with different roles
    - **Archer Tower**: Fast attacks, medium range (100 cost, 150 range, 10 DPS)
    - **Cannon Tower**: Slow, powerful splash damage (250 cost, 200 range, 25 DPS, 60px splash)
    - **Mage Tower**: Magic attacks that slow enemies (200 cost, 175 range, 15 DPS, 50% slow for 2s)
    - **Tesla Tower**: Chain lightning hitting up to 3 enemies (300 cost, 100 range, 20 DPS)
    - **Sniper Tower**: Long-range armor-piercing shots (350 cost, 300 range, 40 DPS)
  - **Unique Tower Visuals**: Each tower has distinctive appearance
    - Archer: Green tower with arrow slits and turret
    - Cannon: Gray tower with large barrel and base
    - Mage: Purple tower with glowing crystal and arcane symbols
    - Tesla: Blue coil tower with electric sphere
    - Sniper: Brown tower with long rifle barrel and scope
  - **Special Attack Patterns**:
    - Cannon: Splash damage with orange explosion effects damaging all enemies in radius
    - Mage: Purple projectiles apply slow debuff with visual indicator
    - Tesla: Instant blue lightning chains between nearby enemies
    - Sniper: Fast orange projectiles with impact flash effects
  - **Different Projectile Types**: Each tower has unique projectile color, size, and speed
  - **Hotkeys 1-5**: Quick tower selection for all 5 towers
  - **Enhanced Visual Effects**: Explosions, lightning bolts, slow indicators, impact flashes
  - **Balance Updates**: Starting gold increased to $500 for better early game strategy
  - Files: Updated [game-004/js/config.js](game-004/js/config.js), [game-004/js/towers.js](game-004/js/towers.js), [game-004/js/enemies.js](game-004/js/enemies.js), [game-004/js/ui.js](game-004/js/ui.js), [game-004/game-plan.md](game-004/game-plan.md)

- **Tower Defense Game** (game-004): Phase 1 - Core Tower Defense Mechanics (MVP)
  - **Modular Architecture**: ES6 module system with event-driven communication
    - Custom EventBus for cross-module messaging without tight coupling
    - Reactive game state management with automatic UI updates
    - Separate modules: config, events, state, map, towers, enemies, waves, ui, main
  - **Grid System & Pathfinding**: Tile-based map with pre-computed enemy paths
    - 32×15 grid (1280×720 desktop resolution, 40px tiles)
    - S-shaped path from left to right with spawn/exit indicators
    - Procedural terrain variation using pseudo-random tile coloring
    - Buildable zones (grass) and no-build zones (path)
  - **Tower System**: Strategic tower placement and combat
    - Archer tower: Fast-firing basic tower ($50 cost, 120 range, 12 damage)
    - Click-to-place interface with visual placement ghost
    - Range indicators on hover and selection
    - Projectile system with target tracking and hit detection
    - "First" targeting priority (enemy closest to exit)
  - **Enemy System**: Path-following enemies with health bars
    - Scout enemy type: Fast movement, low HP (40), $10 reward
    - Smooth waypoint-based pathfinding
    - Dynamic HP bars (green → yellow → red)
    - Death particle effects and floating gold rewards
    - Hit flash feedback on damage
  - **Wave System**: Progressive difficulty with 10 waves
    - Manual wave start (Space or button)
    - Increasing enemy counts and spawn rates per wave
    - Wave completion bonus ($25 gold)
    - "In Progress" status during active waves
  - **Economy & Resources**:
    - Starting gold: $200, Starting lives: 20
    - Earn gold by killing enemies
    - Lose lives when enemies reach the exit
    - Real-time HUD updates using onUpdate polling
  - **User Interface**:
    - Top HUD: Gold ($), Lives (♥), Wave counter, Start Wave button
    - Bottom toolbar: Tower selection buttons with cost, name, hotkey, and icon
    - Centered layout optimized for 16:9 desktop screens
    - Manual hit-testing for toolbar buttons (event masking fix)
    - Visual feedback: button highlighting, placement validation
  - **Controls**:
    - [1] - Select Archer tower for placement
    - [Space] - Start next wave
    - [ESC] - Cancel tower placement / Deselect tower
    - [R] - Restart game
    - Left-click - Place tower or select existing tower
    - Right-click - Cancel placement / Deselect
  - **Victory/Defeat System**:
    - Victory overlay when all 10 waves completed
    - Defeat overlay when lives reach zero
    - Stats display and restart option
  - **Technical Implementation**:
    - Built with Kaplay v4000 (ES6 module import)
    - Custom graphics rendered using Kaplay primitives (rects, circles, text)
    - No external sprites - all visuals procedurally generated
    - Fits desktop screen (1280×720 with letterbox/stretch)
  - Files: [game-004/index.html](game-004/index.html), [game-004/js/](game-004/js/), [game-004/game-plan.md](game-004/game-plan.md), [game-004/lib/kaplay/](game-004/lib/kaplay/)

- **NetHack-Style Roguelike** (game-003): Phase 5 - NPC System
  - **NPC System**: Interactive non-player characters with dialogue
    - 5 NPC types: Merchant, Guard, Wizard, Hermit, Healer
    - Each NPC has unique character, color, and 5 dialogue lines
    - NPCs spawn 2-3 per floor throughout the dungeon
    - Collision detection prevents walking through NPCs
    - NPCs respect fog of war (only visible when in view)
  - **Dialogue System**: Talk to NPCs for immersive interaction
    - Press T key to talk to adjacent NPCs (8 directions)
    - NPC speech appears in message log with color-coded text
    - Format: `NPC Name: "Dialogue text"`
    - Dialogue cycles through 5 unique lines per NPC
    - Bump into NPCs for helpful hint to press T
  - **Persistence**: NPCs saved across game sessions
    - NPC positions and dialogue state saved with level data
    - NPCs persist when traveling between dungeon levels
    - Save/load system fully supports NPC data
  - **New Controls**:
    - T - Talk to nearby NPC
  - Files: Created [game-003/js/NPC.js](game-003/js/NPC.js), updated [game-003/js/Game.js](game-003/js/Game.js), [game-003/js/Renderer.js](game-003/js/Renderer.js), [game-003/js/Input.js](game-003/js/Input.js)

- **NetHack-Style Roguelike** (game-003): Phase 4 - Advanced Features Complete
  - **Magic System**: Mana-based spell casting
    - Added MP (Mana Points) stat: starts at 50, increases +5 per level
    - Fireball spell (F key): 10 MP cost, 15 damage, auto-targets nearest visible enemy
    - Mana refund system when no valid targets available
    - Mana fully restored on level up
  - **Ranged Combat**: Bow-based arrow shooting
    - Arrow shooting (R key): requires bow equipped, 8 damage, 12-tile range
    - Auto-targeting system finds nearest visible monster
    - Bow requirement check before allowing ranged attacks
  - **Projectile System**: Animated spell and arrow effects
    - Projectiles move across screen tile-by-tile
    - Wall collision detection
    - Monster hit detection with damage application
    - Visual feedback with ASCII characters and colors
  - **Field of View (FOV)**: Shadowcasting vision system
    - 10-tile vision radius centered on player
    - Shadowcasting algorithm for realistic line-of-sight
    - Only monsters/items in FOV are visible
    - FOV updates dynamically as player moves
  - **Fog of War**: Persistent exploration memory
    - Explored tiles remain visible but dimmed (#333333)
    - Unexplored areas completely hidden (black)
    - FOV state saved with game for persistence
  - **Multiple Dungeon Levels**: Infinite depth progression
    - Stairs down (>) and stairs up (<) for level navigation
    - Each level procedurally generated
    - Monster difficulty scales with depth (+0.5 monsters per 2 levels)
    - Depth counter in status bar
  - **Level Persistence System**: Visited levels preserved
    - Levels stored by depth number in memory
    - Returning to previous levels restores exact state
    - Map layout, monster positions/HP, items, and fog of war all persist
    - Save/load system handles all visited levels
  - **Enhanced ASCII Graphics**: Colorful varied terrain
    - Floor tiles: 4 character variants (`.`, `·`, `°`, `∙`) with 4 color shades
    - Wall tiles: Textured appearance using `█`, `▓`, `▒` characters
    - Bright yellow stairs for easy visibility
    - Position-based pseudo-random tile selection for organic look
    - Clear visual distinction between walkable and non-walkable tiles
  - **New Controls**:
    - F - Cast Fireball spell (costs 10 MP)
    - R - Shoot Arrow (requires bow equipped)
    - > or Shift+. - Descend stairs
    - < or Shift+, - Ascend stairs
  - **UI Enhancements**:
    - MP display added to status bar
    - Updated controls help with new abilities
    - Spell casting and ranged combat messages
  - Files: Created [game-003/js/FOV.js](game-003/js/FOV.js), [game-003/js/Projectile.js](game-003/js/Projectile.js), updated [game-003/js/Player.js](game-003/js/Player.js), [game-003/js/Map.js](game-003/js/Map.js), [game-003/js/Renderer.js](game-003/js/Renderer.js), [game-003/js/Game.js](game-003/js/Game.js), [game-003/js/Input.js](game-003/js/Input.js), [game-003/index.html](game-003/index.html), [game-003/game-plan.md](game-003/game-plan.md)

- **NetHack-Style Roguelike** (game-003): Phase 4 - Save/Load System Complete
  - **Splash Screen**: Professional menu system for game entry
    - New Game, Load Game, and Quit buttons
    - Styled with gradient background and animated buttons
    - Load Game button enabled only when save data exists
    - Instructions and game description displayed on splash
  - **Save/Load System**: Complete game state persistence using localStorage
    - Save game with Ctrl+S keyboard shortcut
    - Auto-save every 30 seconds during gameplay
    - Load saved game from splash screen menu
    - Confirmation messages for save operations
  - **Serialization System**: Full state preservation
    - Player serialization: position, stats, inventory, equipped items
    - Monster serialization: position, type, HP, status
    - Item serialization: all properties including position and stats
    - Map serialization: tiles, rooms, and dungeon layout
    - Game state serialization: turn count, depth, game state
  - **UI Enhancements**:
    - Equipment bar showing currently equipped weapon and armor
    - Improved status bar layout with better spacing
    - Save confirmation messages in message log
    - Updated help text with save/load instructions
  - Files: Updated [game-003/js/Game.js](game-003/js/Game.js), [game-003/js/Player.js](game-003/js/Player.js), [game-003/js/Monster.js](game-003/js/Monster.js), [game-003/js/Item.js](game-003/js/Item.js), [game-003/js/Map.js](game-003/js/Map.js), [game-003/js/Input.js](game-003/js/Input.js), [game-003/js/main.js](game-003/js/main.js), [game-003/index.html](game-003/index.html), [game-003/styles.css](game-003/styles.css)

- **NetHack-Style Roguelike** (game-003): Phase 3 - Items & Inventory System Complete
  - **Item System**: Comprehensive item types and equipment
    - 5 item types: Weapons, Armor, Potions, Scrolls, Food
    - 4 rarity levels: Common, Uncommon, Rare, Legendary
    - Item templates with 13+ different items (daggers, swords, axes, armor, potions, etc.)
    - Items spawn on dungeon floor (8-12 per level) with rarity based on depth
    - Each item has unique stats: attack/defense bonuses, healing amounts, weight, value
    - ASCII characters and colors for each item type
  - **Inventory System**: Full inventory management
    - 20-slot inventory with pickup/drop mechanics
    - Press G to pick up items, D to drop items, I to toggle inventory screen
    - Stackable consumables (potions, food)
    - Full inventory screen with item list and descriptions
  - **Equipment System**: Weapon and armor slots
    - Equip/unequip weapons and armor from inventory (press 1-9)
    - Equipment bonuses dynamically update player stats
    - Visual equipment display in status bar
    - Attack and Defense stats shown in UI
  - **Consumables**: Usable items with effects
    - Healing potions (Minor: 20 HP, Regular: 40 HP, Greater: 60 HP)
    - Food items (Bread, Rations) for healing
    - Consumables removed from inventory after use
  - Files: Added [game-003/js/Item.js](game-003/js/Item.js), updated Player.js, Game.js, Input.js, Renderer.js, index.html, game-plan.md

- **NetHack-Style Roguelike** (game-003): Phase 2 - Combat & Monster System Complete
  - **Monster System**: 5 different monster types (rat, goblin, snake, orc, troll)
    - Each monster has unique stats: HP, attack, defense, XP rewards
    - ASCII characters and colors for visual distinction
    - Monster AI with pathfinding and chase behavior (10-tile range)
    - Smart movement that routes around walls and obstacles
  - **Combat System**: Turn-based combat mechanics
    - Attack by moving into monsters (bump-to-attack)
    - Monsters retaliate and chase player
    - Damage calculation with defense stats
    - Color-coded combat messages in log
  - **Experience & Leveling System**:
    - XP tracking and level progression
    - Level-up rewards: +10 HP, +2 ATK, +1 DEF, full heal
    - Scaling XP requirements (1.5x per level)
    - XP display in status bar
  - **Monster Spawning**: 5-10 monsters per dungeon level with weighted distribution
  - Files: Added [game-003/js/Monster.js](game-003/js/Monster.js), updated Game.js, Player.js, Renderer.js, index.html
  
- **NetHack-Style Roguelike** (game-003): Phase 1 - Core Dungeon Crawler
  - Procedural dungeon generation using room-and-corridor algorithm
  - 8-directional player movement (Arrow keys, WASD, Q/E/Z/C for diagonals)
  - ASCII-style rendering on HTML5 canvas
  - Turn-based gameplay system
  - Camera following player with smooth scrolling
  - Message log with color-coded events
  - Status bar tracking HP, Level, XP, Depth, and Turn count
  - Collision detection and wall boundaries
  - Modular ES6 architecture
  - Files: [game-003/index.html](game-003/index.html), [game-003/styles.css](game-003/styles.css), [game-003/js/](game-003/js/)

### Fixed
- **Tower Defense Game** (game-004): Fixed Kaplay styled text error with square brackets
  - Issue: Kaplay interprets square brackets `[` `]` as styled text tags, causing "unclosed tags" errors
  - Solution: Changed hotkey display from `[1]` to `(1)` format and updated instruction text to remove brackets
  - Files: [game-004/js/ui.js](game-004/js/ui.js)
- **Tower Defense Game** (game-004): Fixed tower panel height calculation
  - Issue: Panel background was too short, cutting off tower buttons beyond the first one
  - Solution: Added titleSpace constant (32px) to panel height calculation to account for "Towers" title
  - Files: [game-004/js/ui.js](game-004/js/ui.js)
- **Tower Defense Game** (game-004): Fixed tower panel not clickable
  - Issue: Tower buttons in the right panel were not responding to clicks
  - Solution: Added `k.area()` component to tower buttons and attached `onClick()` handlers directly to each button
  - Removed manual hit-testing in favor of Kaplay's built-in area-based click detection
  - Files: [game-004/js/ui.js](game-004/js/ui.js)
- **Tower Defense Game** (game-004): Improved UI text update reliability
  - Issue: Text objects not updating consistently in some Kaplay versions
  - Solution: Recreate text objects on state changes instead of modifying existing text properties
  - Stored text positions for reliable recreation
  - Files: [game-004/js/ui.js](game-004/js/ui.js)
- **Tower Defense Game** (game-004): Fixed click detection overlapping with UI panel
  - Issue: Clicking on the right tower panel would also place towers on the map behind it
  - Solution: Added exclusion zone for right panel area (130px width + 20px margin) in click detection
  - Files: [game-004/js/towers.js](game-004/js/towers.js)
- **NetHack-Style Roguelike** (game-003): Fixed level persistence - levels now remember their state
  - Issue: Descending and returning to previous levels generated new random maps each time
  - Solution: Implemented level storage system that saves/restores level state (map, monsters, items, FOV) by depth
  - Levels are now fully persistent - monsters stay dead, items stay where dropped, map layout unchanged
  - File: [game-003/js/Game.js](game-003/js/Game.js)
- **NetHack-Style Roguelike** (game-003): Fixed status bar not updating after closing inventory screen
  - Issue: Equipment stats would not display properly when returning from inventory view
  - Solution: Added `updateUI()` call after rendering to ensure status bar reflects current equipment state
  - File: [game-003/js/Game.js](game-003/js/Game.js#L270)
- **NetHack-Style Roguelike** (game-003): Fixed message log inconsistent height
  - Changed message log from `max-height` to fixed `height` for consistent display
  - File: [game-003/styles.css](game-003/styles.css#L103)

### Changed
- **Game Browser Refactoring**: Restructured main index.html into modular components
  - Separated HTML, CSS, and JavaScript into dedicated files
  - Created [css/styles.css](css/styles.css) for all styling
  - Created [js/main.js](js/main.js) with modular ES6 classes
  - Created [js/gamedata.js](js/gamedata.js) for centralized game configuration
  - Implemented `GameRenderer` class for dynamic card generation from data
  - Implemented `GameLauncher` class for game launch handling
  - Replaced hard-coded HTML game cards with template-based dynamic rendering
  - Added event-driven architecture using `addEventListener` instead of inline handlers
  - Improved maintainability and scalability for future game additions

## [1.0.0] - 2026-02-03

### Added
- **Space Shooter Game** (game-001): Classic arcade space shooter with keyboard controls
  - Arrow keys for movement, space bar to shoot
  - Score tracking and enemy waves
  - Responsive canvas-based gameplay
- **Match-3 Puzzle Game** (game-002): Strategic gem-matching puzzle game
  - 30 moves limit gameplay
  - Color-coded gems with match detection
  - Score tracking system
  - Built with Kaplay framework
- **Game Browser**: Central hub to browse and launch games
  - Modal-based game player
  - Game cards with descriptions and tags
  - Responsive design
- **GemCore Integration**: Build configuration for desktop deployment
  - Windows build support
  - Customizable app settings
  - Build optimization options

### Fixed
- **Match-3 Game**: Fixed scoring bug where score would continuously increase after the first match
  - Issue: Destroyed gems were not being removed from the grid array, causing them to be counted multiple times in subsequent match checks
  - Solution: Added `grid[gem.gridY][gem.gridX] = null;` in `removeMatches()` function to properly clear grid positions when gems are destroyed
  - File: [game-002/index.html](game-002/index.html#L205)

[1.0.0]: https://github.com/awooldridge/web-games-andrew/releases/tag/v1.0.0
